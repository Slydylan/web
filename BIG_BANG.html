<html><head><meta content="text/html; charset=UTF-8" http-equiv="content-type"><style type="text/css">@import url(https://themes.googleusercontent.com/fonts/css?kit=lhDjYqiy3mZ0x6ROQEUoUw);ol{margin:0;padding:0}table td,table th{padding:0}.c1{background-color:#1e1f20;padding-top:0pt;padding-bottom:0pt;line-height:1.3571428571428572;orphans:2;widows:2;text-align:left}.c9{color:#80868b;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:10.5pt;font-family:"Consolas";font-style:normal}.c0{color:#dcdcdc;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:10.5pt;font-family:"Consolas";font-style:normal}.c17{padding-top:0pt;padding-bottom:0pt;line-height:1.15;orphans:2;widows:2;text-align:left}.c13{font-size:10.5pt;font-family:"Consolas";color:#9cdcfe;font-weight:400}.c15{font-size:10.5pt;font-family:"Consolas";color:#ce9178;font-weight:400}.c14{font-size:10.5pt;font-family:"Consolas";color:#b5cea8;font-weight:400}.c2{font-size:10.5pt;font-family:"Consolas";color:#dcdcdc;font-weight:400}.c11{font-size:10.5pt;font-family:"Consolas";color:#c58af9;font-weight:400}.c12{font-size:10.5pt;font-family:"Consolas";color:#81c995;font-weight:400}.c7{font-size:10.5pt;font-family:"Consolas";color:#569cd6;font-weight:400}.c4{font-size:10.5pt;font-family:"Consolas";color:#fa903e;font-weight:400}.c5{font-size:10.5pt;font-family:"Consolas";color:#808080;font-weight:400}.c6{font-size:10.5pt;font-family:"Consolas";color:#3dc9b0;font-weight:400}.c3{font-size:10.5pt;font-family:"Consolas";color:#d4d4d4;font-weight:400}.c16{color:#000000;font-weight:400;font-size:11pt;font-family:"Arial"}.c10{text-decoration:none;vertical-align:baseline;font-style:normal}.c18{background-color:#ffffff;max-width:468pt;padding:72pt 72pt 72pt 72pt}.c8{height:11pt}.title{padding-top:0pt;color:#000000;font-size:26pt;padding-bottom:3pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}.subtitle{padding-top:0pt;color:#666666;font-size:15pt;padding-bottom:16pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}li{color:#000000;font-size:11pt;font-family:"Arial"}p{margin:0;color:#000000;font-size:11pt;font-family:"Arial"}h1{padding-top:20pt;color:#000000;font-size:20pt;padding-bottom:6pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}h2{padding-top:18pt;color:#000000;font-size:16pt;padding-bottom:6pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}h3{padding-top:16pt;color:#434343;font-size:14pt;padding-bottom:4pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}h4{padding-top:14pt;color:#666666;font-size:12pt;padding-bottom:4pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}h5{padding-top:12pt;color:#666666;font-size:11pt;padding-bottom:4pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}h6{padding-top:12pt;color:#666666;font-size:11pt;padding-bottom:4pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;font-style:italic;orphans:2;widows:2;text-align:left}</style></head><body class="c18 doc-content"><p class="c1"><span class="c7">&lt;!DOCTYPE</span><span class="c13">&nbsp;html</span><span class="c7 c10">&gt;</span></p><p class="c1"><span class="c5">&lt;</span><span class="c7">html</span><span class="c3">&nbsp;</span><span class="c13">lang</span><span class="c5">=</span><span class="c15">&quot;en&quot;</span><span class="c5 c10">&gt;</span></p><p class="c1"><span class="c5">&lt;</span><span class="c7">head</span><span class="c5 c10">&gt;</span></p><p class="c1"><span class="c3">&nbsp; &nbsp; </span><span class="c5">&lt;</span><span class="c7">meta</span><span class="c3">&nbsp;</span><span class="c13">charset</span><span class="c5">=</span><span class="c15">&quot;UTF-8&quot;</span><span class="c5 c10">&gt;</span></p><p class="c1"><span class="c3">&nbsp; &nbsp; </span><span class="c5">&lt;</span><span class="c7">meta</span><span class="c3">&nbsp;</span><span class="c13">name</span><span class="c5">=</span><span class="c15">&quot;viewport&quot;</span><span class="c3">&nbsp;</span><span class="c13">content</span><span class="c5">=</span><span class="c15">&quot;width=device-width, initial-scale=1.0&quot;</span><span class="c5 c10">&gt;</span></p><p class="c1"><span class="c3">&nbsp; &nbsp; </span><span class="c5">&lt;</span><span class="c7">title</span><span class="c5">&gt;</span><span class="c3">The Big Bang: A Generative Narrative</span><span class="c5">&lt;/</span><span class="c7">title</span><span class="c5 c10">&gt;</span></p><p class="c1"><span class="c3">&nbsp; &nbsp; </span><span class="c5">&lt;</span><span class="c7">style</span><span class="c5 c10">&gt;</span></p><p class="c1"><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c7">body</span><span class="c3">&nbsp;</span><span class="c2">{</span><span class="c3">&nbsp;</span><span class="c13">margin:</span><span class="c3">&nbsp;</span><span class="c14">0</span><span class="c2">;</span><span class="c3">&nbsp;</span><span class="c13">overflow:</span><span class="c3">&nbsp;</span><span class="c15">hidden</span><span class="c2">;</span><span class="c3">&nbsp;</span><span class="c13">background-color:</span><span class="c3">&nbsp;#000</span><span class="c2">;</span><span class="c3">&nbsp;</span><span class="c13">color:</span><span class="c3">&nbsp;#fff</span><span class="c2">;</span><span class="c3">&nbsp;</span><span class="c13">font-family:</span><span class="c3">&nbsp;</span><span class="c12">&#39;Inter&#39;</span><span class="c2">,</span><span class="c3">&nbsp;</span><span class="c15">sans-serif</span><span class="c2">;</span><span class="c3">&nbsp;</span><span class="c0">}</span></p><p class="c1"><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c7">canvas</span><span class="c3">&nbsp;</span><span class="c2">{</span><span class="c3">&nbsp;</span><span class="c13">display:</span><span class="c3">&nbsp;</span><span class="c15">block</span><span class="c2">;</span><span class="c3">&nbsp;</span><span class="c0">}</span></p><p class="c1"><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c7">#narrative-panel</span><span class="c3">&nbsp;</span><span class="c0">{</span></p><p class="c1"><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c13">position:</span><span class="c3">&nbsp;</span><span class="c15">absolute</span><span class="c0">;</span></p><p class="c1"><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c13">top:</span><span class="c3">&nbsp;</span><span class="c14">10px</span><span class="c0">;</span></p><p class="c1"><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c13">left:</span><span class="c3">&nbsp;</span><span class="c14">50%</span><span class="c0">;</span></p><p class="c1"><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c13">transform:</span><span class="c3">&nbsp;</span><span class="c15">translateX(</span><span class="c14">-50%</span><span class="c15">)</span><span class="c0">;</span></p><p class="c1"><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c13">padding:</span><span class="c3">&nbsp;</span><span class="c14">15px</span><span class="c3">&nbsp;</span><span class="c14">25px</span><span class="c0">;</span></p><p class="c1"><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c13">background:</span><span class="c3">&nbsp;</span><span class="c15">rgba(</span><span class="c14">0</span><span class="c2">,</span><span class="c3">&nbsp;</span><span class="c14">0</span><span class="c2">,</span><span class="c3">&nbsp;</span><span class="c14">0</span><span class="c2">,</span><span class="c3">&nbsp;</span><span class="c14">0.7</span><span class="c15">)</span><span class="c0">;</span></p><p class="c1"><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c13">border:</span><span class="c3">&nbsp;</span><span class="c14">1px</span><span class="c3">&nbsp;</span><span class="c15">solid</span><span class="c3">&nbsp;#555</span><span class="c0">;</span></p><p class="c1"><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c13">border-radius:</span><span class="c3">&nbsp;</span><span class="c14">10px</span><span class="c0">;</span></p><p class="c1"><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c13">font-size:</span><span class="c3">&nbsp;</span><span class="c14">18px</span><span class="c0">;</span></p><p class="c1"><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c13">line-height:</span><span class="c3">&nbsp;</span><span class="c14">1.5</span><span class="c0">;</span></p><p class="c1"><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c13">text-align:</span><span class="c3">&nbsp;</span><span class="c15">center</span><span class="c0">;</span></p><p class="c1"><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c0">}</span></p><p class="c1"><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c7">#phase-title</span><span class="c3">&nbsp;</span><span class="c2">{</span><span class="c3">&nbsp;</span><span class="c13">font-weight:</span><span class="c3">&nbsp;</span><span class="c14">700</span><span class="c2">;</span><span class="c3">&nbsp;</span><span class="c13">font-size:</span><span class="c3">&nbsp;</span><span class="c14">22px</span><span class="c2">;</span><span class="c3">&nbsp;</span><span class="c13">color:</span><span class="c3">&nbsp;#ffdf80</span><span class="c2">;</span><span class="c3">&nbsp;</span><span class="c0">}</span></p><p class="c1"><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c7">#phase-description</span><span class="c3">&nbsp;</span><span class="c2">{</span><span class="c3">&nbsp;</span><span class="c13">font-size:</span><span class="c3">&nbsp;</span><span class="c14">16px</span><span class="c2">;</span><span class="c3">&nbsp;</span><span class="c13">color:</span><span class="c3">&nbsp;#ccc</span><span class="c2">;</span><span class="c3">&nbsp;</span><span class="c0">}</span></p><p class="c1"><span class="c3">&nbsp; &nbsp; </span><span class="c5">&lt;/</span><span class="c7">style</span><span class="c5 c10">&gt;</span></p><p class="c1"><span class="c3">&nbsp; &nbsp; </span><span class="c5">&lt;</span><span class="c7">link</span><span class="c3">&nbsp;</span><span class="c13">rel</span><span class="c5">=</span><span class="c15">&quot;preconnect&quot;</span><span class="c3">&nbsp;</span><span class="c13">href</span><span class="c5">=</span><span class="c15">&quot;https://fonts.googleapis.com&quot;</span><span class="c5 c10">&gt;</span></p><p class="c1"><span class="c3">&nbsp; &nbsp; </span><span class="c5">&lt;</span><span class="c7">link</span><span class="c3">&nbsp;</span><span class="c13">rel</span><span class="c5">=</span><span class="c15">&quot;preconnect&quot;</span><span class="c3">&nbsp;</span><span class="c13">href</span><span class="c5">=</span><span class="c15">&quot;https://fonts.gstatic.com&quot;</span><span class="c3">&nbsp;</span><span class="c13">crossorigin</span><span class="c5 c10">&gt;</span></p><p class="c1"><span class="c3">&nbsp; &nbsp; </span><span class="c5">&lt;</span><span class="c7">link</span><span class="c3">&nbsp;</span><span class="c13">href</span><span class="c5">=</span><span class="c15">&quot;https://fonts.googleapis.com/css2?family=Inter:wght@400;700&amp;display=swap&quot;</span><span class="c3">&nbsp;</span><span class="c13">rel</span><span class="c5">=</span><span class="c15">&quot;stylesheet&quot;</span><span class="c5 c10">&gt;</span></p><p class="c1"><span class="c5">&lt;/</span><span class="c7">head</span><span class="c5 c10">&gt;</span></p><p class="c1"><span class="c5">&lt;</span><span class="c7">body</span><span class="c5 c10">&gt;</span></p><p class="c1"><span class="c3">&nbsp; &nbsp; </span><span class="c5">&lt;</span><span class="c7">div</span><span class="c3">&nbsp;</span><span class="c13">id</span><span class="c5">=</span><span class="c15">&quot;narrative-panel&quot;</span><span class="c5 c10">&gt;</span></p><p class="c1"><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c5">&lt;</span><span class="c7">div</span><span class="c3">&nbsp;</span><span class="c13">id</span><span class="c5">=</span><span class="c15">&quot;phase-title&quot;</span><span class="c5">&gt;</span><span class="c3">Phase I: The Singularity</span><span class="c5">&lt;/</span><span class="c7">div</span><span class="c5 c10">&gt;</span></p><p class="c1"><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c5">&lt;</span><span class="c7">div</span><span class="c3">&nbsp;</span><span class="c13">id</span><span class="c5">=</span><span class="c15">&quot;phase-description&quot;</span><span class="c5">&gt;</span><span class="c3">A chaotic, undifferentiated field of pure potential.</span><span class="c5">&lt;/</span><span class="c7">div</span><span class="c5 c10">&gt;</span></p><p class="c1"><span class="c3">&nbsp; &nbsp; </span><span class="c5">&lt;/</span><span class="c7">div</span><span class="c5 c10">&gt;</span></p><p class="c1 c8"><span class="c3 c10"></span></p><p class="c1"><span class="c3">&nbsp; &nbsp; </span><span class="c5">&lt;</span><span class="c7">script</span><span class="c3">&nbsp;</span><span class="c13">type</span><span class="c5">=</span><span class="c15">&quot;importmap&quot;</span><span class="c5 c10">&gt;</span></p><p class="c1"><span class="c3 c10">&nbsp; &nbsp; &nbsp; &nbsp; { &quot;imports&quot;: { &quot;three&quot;: &quot;https://cdn.jsdelivr.net/npm/three@0.160.0/build/three.module.js&quot;, &quot;three/addons/&quot;: &quot;https://cdn.jsdelivr.net/npm/three@0.160.0/examples/jsm/&quot; } }</span></p><p class="c1"><span class="c3">&nbsp; &nbsp; </span><span class="c5">&lt;/</span><span class="c7">script</span><span class="c5 c10">&gt;</span></p><p class="c1 c8"><span class="c3 c10"></span></p><p class="c1"><span class="c3">&nbsp; &nbsp; </span><span class="c5">&lt;</span><span class="c7">script</span><span class="c3">&nbsp;</span><span class="c13">type</span><span class="c5">=</span><span class="c15">&quot;module&quot;</span><span class="c5 c10">&gt;</span></p><p class="c1"><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c11">import</span><span class="c3">&nbsp;</span><span class="c2">*</span><span class="c3">&nbsp;as </span><span class="c6">THREE</span><span class="c3">&nbsp;</span><span class="c11">from</span><span class="c3">&nbsp;</span><span class="c12">&#39;three&#39;</span><span class="c0">;</span></p><p class="c1"><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c11">import</span><span class="c3">&nbsp;</span><span class="c2">{</span><span class="c3">&nbsp;</span><span class="c6">OrbitControls</span><span class="c3">&nbsp;</span><span class="c2">}</span><span class="c3">&nbsp;</span><span class="c11">from</span><span class="c3">&nbsp;</span><span class="c12">&#39;three/addons/controls/OrbitControls.js&#39;</span><span class="c0">;</span></p><p class="c1 c8"><span class="c3 c10"></span></p><p class="c1"><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c9">// --- Core Simulation Parameters ---</span></p><p class="c1"><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c11">const</span><span class="c3">&nbsp;</span><span class="c6">GRID_SIZE</span><span class="c3">&nbsp;</span><span class="c2">=</span><span class="c3">&nbsp;</span><span class="c4">30</span><span class="c0">;</span></p><p class="c1"><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c11">const</span><span class="c3">&nbsp;</span><span class="c6">TOTAL_POINTS</span><span class="c3">&nbsp;</span><span class="c2">=</span><span class="c3">&nbsp;</span><span class="c6">GRID_SIZE</span><span class="c3">&nbsp;</span><span class="c2">*</span><span class="c3">&nbsp;</span><span class="c6">GRID_SIZE</span><span class="c3">&nbsp;</span><span class="c2">*</span><span class="c3">&nbsp;</span><span class="c6">GRID_SIZE</span><span class="c0">;</span></p><p class="c1"><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c11">const</span><span class="c3">&nbsp;</span><span class="c6">PARTICLE_THRESHOLD</span><span class="c3">&nbsp;</span><span class="c2">=</span><span class="c3">&nbsp;</span><span class="c4">0.98</span><span class="c2">;</span><span class="c3">&nbsp;</span><span class="c9">// Lowered for visual storytelling</span></p><p class="c1 c8"><span class="c3 c10"></span></p><p class="c1"><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c9">// --- Scene &amp; Simulation State ---</span></p><p class="c1"><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c11">const</span><span class="c3">&nbsp;scene </span><span class="c2">=</span><span class="c3">&nbsp;</span><span class="c11">new</span><span class="c3">&nbsp;</span><span class="c6">THREE</span><span class="c2">.</span><span class="c6">Scene</span><span class="c0">();</span></p><p class="c1"><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c11">const</span><span class="c3">&nbsp;camera </span><span class="c2">=</span><span class="c3">&nbsp;</span><span class="c11">new</span><span class="c3">&nbsp;</span><span class="c6">THREE</span><span class="c2">.</span><span class="c6">PerspectiveCamera</span><span class="c2">(</span><span class="c4">75</span><span class="c2">,</span><span class="c3">&nbsp;window</span><span class="c2">.</span><span class="c3">innerWidth </span><span class="c2">/</span><span class="c3">&nbsp;window</span><span class="c2">.</span><span class="c3">innerHeight</span><span class="c2">,</span><span class="c3">&nbsp;</span><span class="c4">0.1</span><span class="c2">,</span><span class="c3">&nbsp;</span><span class="c4">1000</span><span class="c0">);</span></p><p class="c1"><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; camera</span><span class="c2">.</span><span class="c3">position</span><span class="c2">.</span><span class="c11">set</span><span class="c2">(</span><span class="c6">GRID_SIZE</span><span class="c2">,</span><span class="c3">&nbsp;</span><span class="c6">GRID_SIZE</span><span class="c2">,</span><span class="c3">&nbsp;</span><span class="c6">GRID_SIZE</span><span class="c3">&nbsp;</span><span class="c2">+</span><span class="c3">&nbsp;</span><span class="c4">30</span><span class="c0">);</span></p><p class="c1"><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c11">const</span><span class="c3">&nbsp;renderer </span><span class="c2">=</span><span class="c3">&nbsp;</span><span class="c11">new</span><span class="c3">&nbsp;</span><span class="c6">THREE</span><span class="c2">.</span><span class="c6">WebGLRenderer</span><span class="c2">({</span><span class="c3">&nbsp;antialias</span><span class="c2">:</span><span class="c3">&nbsp;</span><span class="c11">true</span><span class="c3">&nbsp;</span><span class="c0">});</span></p><p class="c1"><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; renderer</span><span class="c2">.</span><span class="c3">setSize</span><span class="c2">(</span><span class="c3">window</span><span class="c2">.</span><span class="c3">innerWidth</span><span class="c2">,</span><span class="c3">&nbsp;window</span><span class="c2">.</span><span class="c3">innerHeight</span><span class="c0">);</span></p><p class="c1"><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; document</span><span class="c2">.</span><span class="c3">body</span><span class="c2">.</span><span class="c3">appendChild</span><span class="c2">(</span><span class="c3">renderer</span><span class="c2">.</span><span class="c3">domElement</span><span class="c0">);</span></p><p class="c1"><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c11">const</span><span class="c3">&nbsp;controls </span><span class="c2">=</span><span class="c3">&nbsp;</span><span class="c11">new</span><span class="c3">&nbsp;</span><span class="c6">OrbitControls</span><span class="c2">(</span><span class="c3">camera</span><span class="c2">,</span><span class="c3">&nbsp;renderer</span><span class="c2">.</span><span class="c3">domElement</span><span class="c0">);</span></p><p class="c1"><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; controls</span><span class="c2">.</span><span class="c3">enableDamping </span><span class="c2">=</span><span class="c3">&nbsp;</span><span class="c11">true</span><span class="c0">;</span></p><p class="c1 c8"><span class="c3 c10"></span></p><p class="c1"><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c11">let</span><span class="c3">&nbsp;lattice_state</span><span class="c2">;</span><span class="c3">&nbsp;</span><span class="c9">// [reality_val, mass_potential]</span></p><p class="c1"><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c11">const</span><span class="c3">&nbsp;clock </span><span class="c2">=</span><span class="c3">&nbsp;</span><span class="c11">new</span><span class="c3">&nbsp;</span><span class="c6">THREE</span><span class="c2">.</span><span class="c6">Clock</span><span class="c0">();</span></p><p class="c1"><span class="c3 c10">&nbsp; &nbsp; &nbsp; &nbsp;</span></p><p class="c1"><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c11">const</span><span class="c3">&nbsp;latticeMesh </span><span class="c2">=</span><span class="c3">&nbsp;</span><span class="c11">new</span><span class="c3">&nbsp;</span><span class="c6">THREE</span><span class="c2">.</span><span class="c6">InstancedMesh</span><span class="c2">(</span><span class="c11">new</span><span class="c3">&nbsp;</span><span class="c6">THREE</span><span class="c2">.</span><span class="c6">BoxGeometry</span><span class="c2">(</span><span class="c4">1</span><span class="c2">,</span><span class="c3">&nbsp;</span><span class="c4">1</span><span class="c2">,</span><span class="c3">&nbsp;</span><span class="c4">1</span><span class="c2">),</span><span class="c3">&nbsp;</span><span class="c11">new</span><span class="c3">&nbsp;</span><span class="c6">THREE</span><span class="c2">.</span><span class="c6">MeshBasicMaterial</span><span class="c2">(),</span><span class="c3">&nbsp;</span><span class="c6">TOTAL_POINTS</span><span class="c0">);</span></p><p class="c1"><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; scene</span><span class="c2">.</span><span class="c3">add</span><span class="c2">(</span><span class="c3">latticeMesh</span><span class="c0">);</span></p><p class="c1 c8"><span class="c3 c10"></span></p><p class="c1"><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c9">// --- Narrative Timeline ---</span></p><p class="c1"><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c11">const</span><span class="c3">&nbsp;</span><span class="c6">NARRATIVE</span><span class="c3">&nbsp;</span><span class="c2">=</span><span class="c3">&nbsp;</span><span class="c0">[</span></p><p class="c1"><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c2">{</span><span class="c3">&nbsp;phase</span><span class="c2">:</span><span class="c3">&nbsp;</span><span class="c12">&quot;Phase I: The Singularity&quot;</span><span class="c2">,</span><span class="c3">&nbsp;duration</span><span class="c2">:</span><span class="c3">&nbsp;</span><span class="c4">5</span><span class="c2">,</span><span class="c3">&nbsp;description</span><span class="c2">:</span><span class="c3">&nbsp;</span><span class="c12">&quot;A chaotic, undifferentiated field of pure potential.&quot;</span><span class="c3">&nbsp;</span><span class="c0">},</span></p><p class="c1"><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c2">{</span><span class="c3">&nbsp;phase</span><span class="c2">:</span><span class="c3">&nbsp;</span><span class="c12">&quot;Phase II: The Great Cooling&quot;</span><span class="c2">,</span><span class="c3">&nbsp;duration</span><span class="c2">:</span><span class="c3">&nbsp;</span><span class="c4">10</span><span class="c2">,</span><span class="c3">&nbsp;description</span><span class="c2">:</span><span class="c3">&nbsp;</span><span class="c12">&quot;The universe expands and evolves towards coherence.&quot;</span><span class="c3">&nbsp;</span><span class="c0">},</span></p><p class="c1"><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c2">{</span><span class="c3">&nbsp;phase</span><span class="c2">:</span><span class="c3">&nbsp;</span><span class="c12">&quot;Phase III: The Higgs Event&quot;</span><span class="c2">,</span><span class="c3">&nbsp;duration</span><span class="c2">:</span><span class="c3">&nbsp;</span><span class="c4">7</span><span class="c2">,</span><span class="c3">&nbsp;description</span><span class="c2">:</span><span class="c3">&nbsp;</span><span class="c12">&quot;A Coherence Cascade gives birth to Mass.&quot;</span><span class="c3">&nbsp;</span><span class="c0">},</span></p><p class="c1"><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c2">{</span><span class="c3">&nbsp;phase</span><span class="c2">:</span><span class="c3">&nbsp;</span><span class="c12">&quot;Phase IV: First Matter&quot;</span><span class="c2">,</span><span class="c3">&nbsp;duration</span><span class="c2">:</span><span class="c3">&nbsp;</span><span class="c4">15</span><span class="c2">,</span><span class="c3">&nbsp;description</span><span class="c2">:</span><span class="c3">&nbsp;</span><span class="c12">&quot;Absences emerge in the massive regions of space.&quot;</span><span class="c3">&nbsp;</span><span class="c0">},</span></p><p class="c1"><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c2">{</span><span class="c3">&nbsp;phase</span><span class="c2">:</span><span class="c3">&nbsp;</span><span class="c12">&quot;Phase V: Eternal Complexity&quot;</span><span class="c2">,</span><span class="c3">&nbsp;duration</span><span class="c2">:</span><span class="c3">&nbsp;</span><span class="c4">999</span><span class="c2">,</span><span class="c3">&nbsp;description</span><span class="c2">:</span><span class="c3">&nbsp;</span><span class="c12">&quot;A stable universe of emergent structure.&quot;</span><span class="c3">&nbsp;</span><span class="c0">}</span></p><p class="c1"><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c0">];</span></p><p class="c1"><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c11">let</span><span class="c3">&nbsp;currentPhaseIndex </span><span class="c2">=</span><span class="c3">&nbsp;</span><span class="c4">0</span><span class="c0">;</span></p><p class="c1"><span class="c3 c10">&nbsp; &nbsp; &nbsp; &nbsp;</span></p><p class="c1"><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c9">// --- Initialization ---</span></p><p class="c1"><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c11">function</span><span class="c3">&nbsp;init</span><span class="c2">()</span><span class="c3">&nbsp;</span><span class="c0">{</span></p><p class="c1"><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; lattice_state </span><span class="c2">=</span><span class="c3">&nbsp;</span><span class="c11">new</span><span class="c3">&nbsp;</span><span class="c6">Array</span><span class="c2">(</span><span class="c6">TOTAL_POINTS</span><span class="c2">).</span><span class="c3">fill</span><span class="c2">(</span><span class="c4">0</span><span class="c2">).</span><span class="c3">map</span><span class="c2">(()</span><span class="c3">&nbsp;</span><span class="c2">=&gt;</span><span class="c3">&nbsp;</span><span class="c2">[</span><span class="c6">Math</span><span class="c2">.</span><span class="c3">random</span><span class="c2">()</span><span class="c3">&nbsp;</span><span class="c2">*</span><span class="c3">&nbsp;</span><span class="c4">0.2</span><span class="c2">,</span><span class="c3">&nbsp;</span><span class="c4">0</span><span class="c0">]);</span></p><p class="c1"><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; latticeMesh</span><span class="c2">.</span><span class="c3">instanceColor </span><span class="c2">=</span><span class="c3">&nbsp;</span><span class="c11">new</span><span class="c3">&nbsp;</span><span class="c6">THREE</span><span class="c2">.</span><span class="c6">InstancedBufferAttribute</span><span class="c2">(</span><span class="c11">new</span><span class="c3">&nbsp;</span><span class="c6">Float32Array</span><span class="c2">(</span><span class="c6">TOTAL_POINTS</span><span class="c3">&nbsp;</span><span class="c2">*</span><span class="c3">&nbsp;</span><span class="c4">3</span><span class="c2">),</span><span class="c3">&nbsp;</span><span class="c4">3</span><span class="c0">);</span></p><p class="c1"><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; updateLatticeVisuals</span><span class="c2">(</span><span class="c4">0</span><span class="c0">);</span></p><p class="c1"><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c0">}</span></p><p class="c1 c8"><span class="c3 c10"></span></p><p class="c1"><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c9">// --- Update &amp; Visualization ---</span></p><p class="c1"><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c11">function</span><span class="c3">&nbsp;updateLatticeVisuals</span><span class="c2">(</span><span class="c3">elapsedTime</span><span class="c2">)</span><span class="c3">&nbsp;</span><span class="c0">{</span></p><p class="c1"><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c11">const</span><span class="c3">&nbsp;dummy </span><span class="c2">=</span><span class="c3">&nbsp;</span><span class="c11">new</span><span class="c3">&nbsp;</span><span class="c6">THREE</span><span class="c2">.</span><span class="c6">Object3D</span><span class="c0">();</span></p><p class="c1"><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c11">const</span><span class="c3">&nbsp;color </span><span class="c2">=</span><span class="c3">&nbsp;</span><span class="c11">new</span><span class="c3">&nbsp;</span><span class="c6">THREE</span><span class="c2">.</span><span class="c6">Color</span><span class="c0">();</span></p><p class="c1"><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c11">let</span><span class="c3">&nbsp;phaseTime </span><span class="c2">=</span><span class="c3">&nbsp;</span><span class="c4">0</span><span class="c0">;</span></p><p class="c1"><span class="c3 c10">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span></p><p class="c1"><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c9">// Determine current phase</span></p><p class="c1"><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c11">let</span><span class="c3">&nbsp;cumulativeDuration </span><span class="c2">=</span><span class="c3">&nbsp;</span><span class="c4">0</span><span class="c0">;</span></p><p class="c1"><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c11">for</span><span class="c2">(</span><span class="c11">let</span><span class="c3">&nbsp;i </span><span class="c2">=</span><span class="c3">&nbsp;</span><span class="c4">0</span><span class="c2">;</span><span class="c3">&nbsp;i </span><span class="c2">&lt;</span><span class="c3">&nbsp;</span><span class="c6">NARRATIVE</span><span class="c2">.</span><span class="c3">length</span><span class="c2">;</span><span class="c3">&nbsp;i</span><span class="c2">++)</span><span class="c3">&nbsp;</span><span class="c0">{</span></p><p class="c1"><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c11">if</span><span class="c3">&nbsp;</span><span class="c2">(</span><span class="c3">elapsedTime </span><span class="c2">&lt;</span><span class="c3">&nbsp;cumulativeDuration </span><span class="c2">+</span><span class="c3">&nbsp;</span><span class="c6">NARRATIVE</span><span class="c2">[</span><span class="c3">i</span><span class="c2">].</span><span class="c3">duration</span><span class="c2">)</span><span class="c3">&nbsp;</span><span class="c0">{</span></p><p class="c1"><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; currentPhaseIndex </span><span class="c2">=</span><span class="c3">&nbsp;i</span><span class="c0">;</span></p><p class="c1"><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; phaseTime </span><span class="c2">=</span><span class="c3">&nbsp;</span><span class="c2">(</span><span class="c3">elapsedTime </span><span class="c2">-</span><span class="c3">&nbsp;cumulativeDuration</span><span class="c2">)</span><span class="c3">&nbsp;</span><span class="c2">/</span><span class="c3">&nbsp;</span><span class="c6">NARRATIVE</span><span class="c2">[</span><span class="c3">i</span><span class="c2">].</span><span class="c3">duration</span><span class="c2">;</span><span class="c3">&nbsp;</span><span class="c9">// Progress within phase (0 to 1)</span></p><p class="c1"><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c11">break</span><span class="c0">;</span></p><p class="c1"><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c0">}</span></p><p class="c1"><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; cumulativeDuration </span><span class="c2">+=</span><span class="c3">&nbsp;</span><span class="c6">NARRATIVE</span><span class="c2">[</span><span class="c3">i</span><span class="c2">].</span><span class="c3">duration</span><span class="c0">;</span></p><p class="c1"><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c0">}</span></p><p class="c1"><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c11">if</span><span class="c3">&nbsp;</span><span class="c2">(</span><span class="c3">elapsedTime </span><span class="c2">&gt;=</span><span class="c3">&nbsp;cumulativeDuration</span><span class="c2">)</span><span class="c3">&nbsp;</span><span class="c2">{</span><span class="c3">&nbsp;</span><span class="c9">// Lock to last phase</span></p><p class="c1"><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; currentPhaseIndex </span><span class="c2">=</span><span class="c3">&nbsp;</span><span class="c6">NARRATIVE</span><span class="c2">.</span><span class="c3">length </span><span class="c2">-</span><span class="c3">&nbsp;</span><span class="c4">1</span><span class="c0">;</span></p><p class="c1"><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; phaseTime </span><span class="c2">=</span><span class="c3">&nbsp;</span><span class="c4">1</span><span class="c0">;</span></p><p class="c1"><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c0">}</span></p><p class="c1 c8"><span class="c3 c10"></span></p><p class="c1"><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c9">// Update UI</span></p><p class="c1"><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; document</span><span class="c2">.</span><span class="c3">getElementById</span><span class="c2">(</span><span class="c12">&#39;phase-title&#39;</span><span class="c2">).</span><span class="c3">textContent </span><span class="c2">=</span><span class="c3">&nbsp;</span><span class="c6">NARRATIVE</span><span class="c2">[</span><span class="c3">currentPhaseIndex</span><span class="c2">].</span><span class="c3">phase</span><span class="c0">;</span></p><p class="c1"><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; document</span><span class="c2">.</span><span class="c3">getElementById</span><span class="c2">(</span><span class="c12">&#39;phase-description&#39;</span><span class="c2">).</span><span class="c3">textContent </span><span class="c2">=</span><span class="c3">&nbsp;</span><span class="c6">NARRATIVE</span><span class="c2">[</span><span class="c3">currentPhaseIndex</span><span class="c2">].</span><span class="c3">description</span><span class="c0">;</span></p><p class="c1"><span class="c3 c10">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span></p><p class="c1"><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c9">// Higgs Event trigger point</span></p><p class="c1"><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c11">const</span><span class="c3">&nbsp;higgs_center </span><span class="c2">=</span><span class="c3">&nbsp;</span><span class="c11">new</span><span class="c3">&nbsp;</span><span class="c6">THREE</span><span class="c2">.</span><span class="c6">Vector3</span><span class="c2">(</span><span class="c6">GRID_SIZE</span><span class="c3">&nbsp;</span><span class="c2">/</span><span class="c3">&nbsp;</span><span class="c4">2</span><span class="c2">,</span><span class="c3">&nbsp;</span><span class="c6">GRID_SIZE</span><span class="c3">&nbsp;</span><span class="c2">/</span><span class="c3">&nbsp;</span><span class="c4">2</span><span class="c2">,</span><span class="c3">&nbsp;</span><span class="c6">GRID_SIZE</span><span class="c3">&nbsp;</span><span class="c2">/</span><span class="c3">&nbsp;</span><span class="c4">2</span><span class="c0">);</span></p><p class="c1"><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c11">const</span><span class="c3">&nbsp;higgs_radius </span><span class="c2">=</span><span class="c3">&nbsp;</span><span class="c6">GRID_SIZE</span><span class="c3">&nbsp;</span><span class="c2">/</span><span class="c3">&nbsp;</span><span class="c4">4</span><span class="c0">;</span></p><p class="c1 c8"><span class="c3 c10"></span></p><p class="c1"><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c11">for</span><span class="c3">&nbsp;</span><span class="c2">(</span><span class="c11">let</span><span class="c3">&nbsp;i </span><span class="c2">=</span><span class="c3">&nbsp;</span><span class="c4">0</span><span class="c2">;</span><span class="c3">&nbsp;i </span><span class="c2">&lt;</span><span class="c3">&nbsp;</span><span class="c6">TOTAL_POINTS</span><span class="c2">;</span><span class="c3">&nbsp;i</span><span class="c2">++)</span><span class="c3">&nbsp;</span><span class="c0">{</span></p><p class="c1"><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c11">const</span><span class="c3">&nbsp;x </span><span class="c2">=</span><span class="c3">&nbsp;i </span><span class="c2">%</span><span class="c3">&nbsp;</span><span class="c6">GRID_SIZE</span><span class="c0">;</span></p><p class="c1"><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c11">const</span><span class="c3">&nbsp;y </span><span class="c2">=</span><span class="c3">&nbsp;</span><span class="c6">Math</span><span class="c2">.</span><span class="c3">floor</span><span class="c2">(</span><span class="c3">i </span><span class="c2">/</span><span class="c3">&nbsp;</span><span class="c6">GRID_SIZE</span><span class="c2">)</span><span class="c3">&nbsp;</span><span class="c2">%</span><span class="c3">&nbsp;</span><span class="c6">GRID_SIZE</span><span class="c0">;</span></p><p class="c1"><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c11">const</span><span class="c3">&nbsp;z </span><span class="c2">=</span><span class="c3">&nbsp;</span><span class="c6">Math</span><span class="c2">.</span><span class="c3">floor</span><span class="c2">(</span><span class="c3">i </span><span class="c2">/</span><span class="c3">&nbsp;</span><span class="c2">(</span><span class="c6">GRID_SIZE</span><span class="c3">&nbsp;</span><span class="c2">*</span><span class="c3">&nbsp;</span><span class="c6">GRID_SIZE</span><span class="c0">));</span></p><p class="c1 c8"><span class="c3 c10"></span></p><p class="c1"><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c11">let</span><span class="c3">&nbsp;</span><span class="c2">[</span><span class="c3">reality_val</span><span class="c2">,</span><span class="c3">&nbsp;mass_potential</span><span class="c2">]</span><span class="c3">&nbsp;</span><span class="c2">=</span><span class="c3">&nbsp;lattice_state</span><span class="c2">[</span><span class="c3">i</span><span class="c0">];</span></p><p class="c1"><span class="c3 c10">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span></p><p class="c1"><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c9">// --- Animate State Based on Narrative Phase ---</span></p><p class="c1"><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c11">switch</span><span class="c2">(</span><span class="c3">currentPhaseIndex</span><span class="c2">)</span><span class="c3">&nbsp;</span><span class="c0">{</span></p><p class="c1"><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c11">case</span><span class="c3">&nbsp;</span><span class="c4">0</span><span class="c2">:</span><span class="c3">&nbsp;</span><span class="c9">// Singularity</span></p><p class="c1"><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; reality_val </span><span class="c2">=</span><span class="c3">&nbsp;</span><span class="c6">THREE</span><span class="c2">.</span><span class="c6">MathUtils</span><span class="c2">.</span><span class="c3">lerp</span><span class="c2">(</span><span class="c3">reality_val</span><span class="c2">,</span><span class="c3">&nbsp;</span><span class="c6">Math</span><span class="c2">.</span><span class="c3">random</span><span class="c2">()</span><span class="c3">&nbsp;</span><span class="c2">*</span><span class="c3">&nbsp;</span><span class="c4">0.2</span><span class="c2">,</span><span class="c3">&nbsp;</span><span class="c4">0.01</span><span class="c0">);</span></p><p class="c1"><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c11">break</span><span class="c0">;</span></p><p class="c1"><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c11">case</span><span class="c3">&nbsp;</span><span class="c4">1</span><span class="c2">:</span><span class="c3">&nbsp;</span><span class="c9">// The Great Cooling</span></p><p class="c1"><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; reality_val </span><span class="c2">=</span><span class="c3">&nbsp;</span><span class="c6">THREE</span><span class="c2">.</span><span class="c6">MathUtils</span><span class="c2">.</span><span class="c3">lerp</span><span class="c2">(</span><span class="c3">reality_val</span><span class="c2">,</span><span class="c3">&nbsp;</span><span class="c4">0.95</span><span class="c2">,</span><span class="c3">&nbsp;phaseTime </span><span class="c2">*</span><span class="c3">&nbsp;</span><span class="c4">0.05</span><span class="c0">);</span></p><p class="c1"><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c11">break</span><span class="c0">;</span></p><p class="c1"><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c11">case</span><span class="c3">&nbsp;</span><span class="c4">2</span><span class="c2">:</span><span class="c3">&nbsp;</span><span class="c9">// The Higgs Event</span></p><p class="c1"><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c11">const</span><span class="c3">&nbsp;dist </span><span class="c2">=</span><span class="c3">&nbsp;higgs_center</span><span class="c2">.</span><span class="c3">distanceTo</span><span class="c2">(</span><span class="c11">new</span><span class="c3">&nbsp;</span><span class="c6">THREE</span><span class="c2">.</span><span class="c6">Vector3</span><span class="c2">(</span><span class="c3">x</span><span class="c2">,</span><span class="c3">&nbsp;y</span><span class="c2">,</span><span class="c3">&nbsp;z</span><span class="c0">));</span></p><p class="c1"><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c11">if</span><span class="c3">&nbsp;</span><span class="c2">(</span><span class="c3">dist </span><span class="c2">&lt;</span><span class="c3">&nbsp;higgs_radius</span><span class="c2">)</span><span class="c3">&nbsp;</span><span class="c0">{</span></p><p class="c1"><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c9">// Flash of creation</span></p><p class="c1"><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; reality_val </span><span class="c2">=</span><span class="c3">&nbsp;</span><span class="c6">THREE</span><span class="c2">.</span><span class="c6">MathUtils</span><span class="c2">.</span><span class="c3">lerp</span><span class="c2">(</span><span class="c3">reality_val</span><span class="c2">,</span><span class="c3">&nbsp;</span><span class="c4">1.0</span><span class="c2">,</span><span class="c3">&nbsp;phaseTime</span><span class="c0">);</span></p><p class="c1"><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c11">if</span><span class="c3">&nbsp;</span><span class="c2">(</span><span class="c3">phaseTime </span><span class="c2">&gt;</span><span class="c3">&nbsp;</span><span class="c4">0.9</span><span class="c2">)</span><span class="c3">&nbsp;mass_potential </span><span class="c2">=</span><span class="c3">&nbsp;</span><span class="c4">1.0</span><span class="c0">;</span></p><p class="c1"><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c0">}</span></p><p class="c1"><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c11">break</span><span class="c0">;</span></p><p class="c1"><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c11">case</span><span class="c3">&nbsp;</span><span class="c4">3</span><span class="c2">:</span><span class="c3">&nbsp;</span><span class="c9">// First Matter</span></p><p class="c1"><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c11">case</span><span class="c3">&nbsp;</span><span class="c4">4</span><span class="c2">:</span><span class="c3">&nbsp;</span><span class="c9">// Eternal Complexity</span></p><p class="c1"><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c11">if</span><span class="c3">&nbsp;</span><span class="c2">(</span><span class="c3">mass_potential </span><span class="c2">&gt;</span><span class="c3">&nbsp;</span><span class="c4">0</span><span class="c2">)</span><span class="c3">&nbsp;</span><span class="c0">{</span></p><p class="c1"><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c9">// Massive regions continue to cool towards the particle threshold</span></p><p class="c1"><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; reality_val </span><span class="c2">=</span><span class="c3">&nbsp;</span><span class="c6">THREE</span><span class="c2">.</span><span class="c6">MathUtils</span><span class="c2">.</span><span class="c3">lerp</span><span class="c2">(</span><span class="c3">reality_val</span><span class="c2">,</span><span class="c3">&nbsp;</span><span class="c4">0.99</span><span class="c2">,</span><span class="c3">&nbsp;phaseTime </span><span class="c2">*</span><span class="c3">&nbsp;</span><span class="c4">0.05</span><span class="c0">);</span></p><p class="c1"><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c2">}</span><span class="c3">&nbsp;</span><span class="c11">else</span><span class="c3">&nbsp;</span><span class="c0">{</span></p><p class="c1"><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c9">// Non-massive regions remain less coherent</span></p><p class="c1"><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; reality_val </span><span class="c2">=</span><span class="c3">&nbsp;</span><span class="c6">THREE</span><span class="c2">.</span><span class="c6">MathUtils</span><span class="c2">.</span><span class="c3">lerp</span><span class="c2">(</span><span class="c3">reality_val</span><span class="c2">,</span><span class="c3">&nbsp;</span><span class="c4">0.95</span><span class="c2">,</span><span class="c3">&nbsp;</span><span class="c4">0.01</span><span class="c0">);</span></p><p class="c1"><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c0">}</span></p><p class="c1"><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c11">break</span><span class="c0">;</span></p><p class="c1"><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c0">}</span></p><p class="c1"><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; lattice_state</span><span class="c2">[</span><span class="c3">i</span><span class="c2">]</span><span class="c3">&nbsp;</span><span class="c2">=</span><span class="c3">&nbsp;</span><span class="c2">[</span><span class="c3">reality_val</span><span class="c2">,</span><span class="c3">&nbsp;mass_potential</span><span class="c0">];</span></p><p class="c1 c8"><span class="c3 c10"></span></p><p class="c1"><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c9">// --- Update Visuals ---</span></p><p class="c1"><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; dummy</span><span class="c2">.</span><span class="c3">position</span><span class="c2">.</span><span class="c11">set</span><span class="c2">(</span><span class="c3">x </span><span class="c2">-</span><span class="c3">&nbsp;</span><span class="c6">GRID_SIZE</span><span class="c3">&nbsp;</span><span class="c2">/</span><span class="c3">&nbsp;</span><span class="c4">2</span><span class="c2">,</span><span class="c3">&nbsp;y </span><span class="c2">-</span><span class="c3">&nbsp;</span><span class="c6">GRID_SIZE</span><span class="c3">&nbsp;</span><span class="c2">/</span><span class="c3">&nbsp;</span><span class="c4">2</span><span class="c2">,</span><span class="c3">&nbsp;z </span><span class="c2">-</span><span class="c3">&nbsp;</span><span class="c6">GRID_SIZE</span><span class="c3">&nbsp;</span><span class="c2">/</span><span class="c3">&nbsp;</span><span class="c4">2</span><span class="c0">);</span></p><p class="c1"><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c11">const</span><span class="c3">&nbsp;isParticle </span><span class="c2">=</span><span class="c3">&nbsp;reality_val </span><span class="c2">&gt;=</span><span class="c3">&nbsp;</span><span class="c6">PARTICLE_THRESHOLD</span><span class="c0">;</span></p><p class="c1"><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c11">const</span><span class="c3">&nbsp;scale </span><span class="c2">=</span><span class="c3">&nbsp;isParticle </span><span class="c2">?</span><span class="c3">&nbsp;</span><span class="c4">0</span><span class="c3">&nbsp;</span><span class="c2">:</span><span class="c3">&nbsp;</span><span class="c4">1</span><span class="c0">;</span></p><p class="c1"><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; dummy</span><span class="c2">.</span><span class="c3">scale</span><span class="c2">.</span><span class="c11">set</span><span class="c2">(</span><span class="c3">scale</span><span class="c2">,</span><span class="c3">&nbsp;scale</span><span class="c2">,</span><span class="c3">&nbsp;scale</span><span class="c0">);</span></p><p class="c1"><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; dummy</span><span class="c2">.</span><span class="c3">updateMatrix</span><span class="c0">();</span></p><p class="c1"><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; latticeMesh</span><span class="c2">.</span><span class="c3">setMatrixAt</span><span class="c2">(</span><span class="c3">i</span><span class="c2">,</span><span class="c3">&nbsp;dummy</span><span class="c2">.</span><span class="c3">matrix</span><span class="c0">);</span></p><p class="c1"><span class="c3 c10">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span></p><p class="c1"><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c9">// --- MODIFIED: High-Contrast Color Logic ---</span></p><p class="c1"><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c11">let</span><span class="c3">&nbsp;hue </span><span class="c2">=</span><span class="c3">&nbsp;</span><span class="c4">0.6</span><span class="c3">&nbsp;</span><span class="c2">-</span><span class="c3">&nbsp;</span><span class="c2">(</span><span class="c3">mass_potential </span><span class="c2">*</span><span class="c3">&nbsp;</span><span class="c4">0.5</span><span class="c2">);</span><span class="c3">&nbsp;</span><span class="c9">// Blue (0.6) to Yellow/Gold (0.1)</span></p><p class="c1"><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c11">let</span><span class="c3">&nbsp;saturation </span><span class="c2">=</span><span class="c3">&nbsp;</span><span class="c4">1.0</span><span class="c0">;</span></p><p class="c1"><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c11">let</span><span class="c3">&nbsp;lightness </span><span class="c2">=</span><span class="c3">&nbsp;</span><span class="c4">0.1</span><span class="c3">&nbsp;</span><span class="c2">+</span><span class="c3">&nbsp;</span><span class="c2">(</span><span class="c3">reality_val </span><span class="c2">*</span><span class="c3">&nbsp;</span><span class="c4">0.7</span><span class="c2">);</span><span class="c3">&nbsp;</span><span class="c9">// Expanded lightness range</span></p><p class="c1 c8"><span class="c3 c10"></span></p><p class="c1"><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c9">// Special effect for Higgs Event flash</span></p><p class="c1"><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c11">if</span><span class="c3">&nbsp;</span><span class="c2">(</span><span class="c3">currentPhaseIndex </span><span class="c2">===</span><span class="c3">&nbsp;</span><span class="c4">2</span><span class="c2">)</span><span class="c3">&nbsp;</span><span class="c0">{</span></p><p class="c1"><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c11">const</span><span class="c3">&nbsp;dist </span><span class="c2">=</span><span class="c3">&nbsp;higgs_center</span><span class="c2">.</span><span class="c3">distanceTo</span><span class="c2">(</span><span class="c11">new</span><span class="c3">&nbsp;</span><span class="c6">THREE</span><span class="c2">.</span><span class="c6">Vector3</span><span class="c2">(</span><span class="c3">x</span><span class="c2">,</span><span class="c3">&nbsp;y</span><span class="c2">,</span><span class="c3">&nbsp;z</span><span class="c0">));</span></p><p class="c1"><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c11">if</span><span class="c3">&nbsp;</span><span class="c2">(</span><span class="c3">dist </span><span class="c2">&lt;</span><span class="c3">&nbsp;higgs_radius</span><span class="c2">)</span><span class="c3">&nbsp;</span><span class="c0">{</span></p><p class="c1"><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c9">// The flash is brightest at the peak of the phase</span></p><p class="c1"><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c11">const</span><span class="c3">&nbsp;flash </span><span class="c2">=</span><span class="c3">&nbsp;</span><span class="c6">Math</span><span class="c2">.</span><span class="c3">sin</span><span class="c2">(</span><span class="c3">phaseTime </span><span class="c2">*</span><span class="c3">&nbsp;</span><span class="c6">Math</span><span class="c2">.</span><span class="c6">PI</span><span class="c2">);</span><span class="c3">&nbsp;</span><span class="c9">// A smooth pulse from 0 to 1 and back to 0</span></p><p class="c1"><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; lightness </span><span class="c2">=</span><span class="c3">&nbsp;</span><span class="c6">Math</span><span class="c2">.</span><span class="c3">max</span><span class="c2">(</span><span class="c3">lightness</span><span class="c2">,</span><span class="c3">&nbsp;flash </span><span class="c2">*</span><span class="c3">&nbsp;</span><span class="c4">0.9</span><span class="c0">);</span></p><p class="c1"><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; saturation </span><span class="c2">=</span><span class="c3">&nbsp;</span><span class="c6">Math</span><span class="c2">.</span><span class="c3">max</span><span class="c2">(</span><span class="c4">0</span><span class="c2">,</span><span class="c3">&nbsp;</span><span class="c4">1.0</span><span class="c3">&nbsp;</span><span class="c2">-</span><span class="c3">&nbsp;flash</span><span class="c2">);</span><span class="c3">&nbsp;</span><span class="c9">// Desaturate to white at the peak</span></p><p class="c1"><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c0">}</span></p><p class="c1"><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c0">}</span></p><p class="c1"><span class="c3 c10">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span></p><p class="c1"><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; color</span><span class="c2">.</span><span class="c3">setHSL</span><span class="c2">(</span><span class="c3">hue</span><span class="c2">,</span><span class="c3">&nbsp;saturation</span><span class="c2">,</span><span class="c3">&nbsp;lightness</span><span class="c0">);</span></p><p class="c1"><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; latticeMesh</span><span class="c2">.</span><span class="c3">setColorAt</span><span class="c2">(</span><span class="c3">i</span><span class="c2">,</span><span class="c3">&nbsp;color</span><span class="c0">);</span></p><p class="c1"><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c0">}</span></p><p class="c1"><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; latticeMesh</span><span class="c2">.</span><span class="c3">instanceMatrix</span><span class="c2">.</span><span class="c3">needsUpdate </span><span class="c2">=</span><span class="c3">&nbsp;</span><span class="c11">true</span><span class="c0">;</span></p><p class="c1"><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; latticeMesh</span><span class="c2">.</span><span class="c3">instanceColor</span><span class="c2">.</span><span class="c3">needsUpdate </span><span class="c2">=</span><span class="c3">&nbsp;</span><span class="c11">true</span><span class="c0">;</span></p><p class="c1"><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c0">}</span></p><p class="c1 c8"><span class="c3 c10"></span></p><p class="c1"><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c11">function</span><span class="c3">&nbsp;animate</span><span class="c2">()</span><span class="c3">&nbsp;</span><span class="c0">{</span></p><p class="c1"><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; requestAnimationFrame</span><span class="c2">(</span><span class="c3">animate</span><span class="c0">);</span></p><p class="c1"><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; controls</span><span class="c2">.</span><span class="c3">update</span><span class="c0">();</span></p><p class="c1"><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c11">const</span><span class="c3">&nbsp;elapsedTime </span><span class="c2">=</span><span class="c3">&nbsp;clock</span><span class="c2">.</span><span class="c3">getElapsedTime</span><span class="c0">();</span></p><p class="c1"><span class="c3 c10">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span></p><p class="c1"><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; updateLatticeVisuals</span><span class="c2">(</span><span class="c3">elapsedTime</span><span class="c0">);</span></p><p class="c1"><span class="c3 c10">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span></p><p class="c1"><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; renderer</span><span class="c2">.</span><span class="c3">render</span><span class="c2">(</span><span class="c3">scene</span><span class="c2">,</span><span class="c3">&nbsp;camera</span><span class="c0">);</span></p><p class="c1"><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c0">}</span></p><p class="c1"><span class="c3 c10">&nbsp; &nbsp; &nbsp; &nbsp;</span></p><p class="c1"><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; init</span><span class="c0">();</span></p><p class="c1"><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; animate</span><span class="c0">();</span></p><p class="c1"><span class="c3">&nbsp; &nbsp; </span><span class="c5">&lt;/</span><span class="c7">script</span><span class="c5 c10">&gt;</span></p><p class="c1"><span class="c5">&lt;/</span><span class="c7">body</span><span class="c5 c10">&gt;</span></p><p class="c1"><span class="c5">&lt;/</span><span class="c7">html</span><span class="c5 c10">&gt;</span></p><p class="c1 c8"><span class="c3 c10"></span></p><p class="c8 c17"><span class="c10 c16"></span></p></body></html>